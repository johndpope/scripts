item_list = {
  [3] = {182725, 182726, 182727, 182728, 182729, 182730, 88384, 88349, 192192, 192226, 192228, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [4] = {136754, 136967, 154577, 156915, 169122, 175001, 88384, 88349, 192192, 192226, 192228, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [6] = {133664, 154895, 157510, 162598, 163919, 175372, 192268, 75188, 77301,192226, 192228, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [7] = {133663, 154888, 157507, 162557, 163882, 175362, 192268, 75188, 77301,192226, 192228, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [9] = {160546, 160547, 160548, 160549, 160552, 160553, 88384, 88349, 192192, 192226, 192228, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [10] = {183383, 183384, 183385, 183387, 183388, 183389, 88384, 88349, 192192, 192226, 192228, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [13] = {136423, 136847, 137012, 154677, 156972, 169161, 192191, 192202, 192205, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 88385, 52267, 170655, 170655, 53035},
  [14] = {136254, 136742, 136960, 154567, 156914, 169115, 192191, 192202, 192205, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 88385, 52267, 170655, 170655, 53035},
  [16] = {135693, 135694, 135695, 135696, 135697, 135698, 192191, 192202, 192205, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 88385, 52267, 170655, 170655, 53035},
  [17] = {136311, 136777, 155316, 162501, 178809, 187119, 192191, 192202, 192205, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 88385, 52267, 170655, 170655, 53035},
  [19] = {136434, 136857, 139714, 155443, 162602, 163925, 192191, 192202, 192205, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 88385, 52267, 170655, 170655, 53035},
  [20] = {174889, 174890, 174891, 174892, 174893, 174894, 192191, 192202, 192205, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 88385, 52267, 170655, 170655, 53035},
  [23] = {181245, 181246, 181247, 181248, 181249, 181250, 192216, 192220, 192214, 170655, 170655, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 53035, 77310},
  [24] = {144050, 144051, 144052, 144053, 144054, 144055, 192216, 192220, 192214, 170655, 170655, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 53035, 77310},
  [26] = {155369, 168957, 174369, 178582, 180511, 191844, 192216, 192220, 192214, 170655, 170655, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 53035, 77310},
  [27] = {155242, 168915, 174311, 178572, 180466, 191840, 192216, 192220, 192214, 170655, 170655, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 53035, 77310},
  [29] = {148870, 148871, 148872, 148873, 148874, 148875, 192216, 192220, 192214, 170655, 170655, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 53035, 77310},
  [30] = {176395, 176396, 176397, 176398, 176399, 176400, 176401, 192216, 192220, 192214, 170655, 170655, 151319, 151312, 151304, 151304, 151302, 151302, 133998, 53035, 77310},
  [33] = {164362, 164363, 164364, 164365, 164366, 164368, 192221, 192222, 192224, 88346, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [34] = {166358, 166359, 166360, 166361, 166362, 166363, 192221, 192222, 192224, 88346, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [36] = {136249, 136740, 139682, 155255, 162457, 163799, 192221, 192222, 192224, 88346, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [37] = {136307, 136775, 139691, 155313, 162499, 163835, 192221, 192222, 192224, 88346, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [39] = {158152, 158153, 158154, 158155, 158156, 158157, 192221, 192222, 192224, 88346, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938},
  [40] = {143883, 143884, 143886, 143887, 143888, 143889, 143890, 192221, 192222, 192224, 88346, 151466, 151470, 151470, 151476, 151476, 151479, 170687, 170687, 40481, 164938}
}

function hailed(NPC, Player)
  Emote(NPC, "looks upon you with burning eyes.", Player, Player)

  local conversation = CreateConversation()

  if GetLevel(Player) < 25 then
    AddConversationOption(conversation, "I could use some buffs.", "BuffMeBro")
  else
    AddConversationOption(conversation, "I could use some food and drink", "GiveFoodDrink")
    AddConversationOption(conversation, "I need to change my alignment", "ChangeAlignment")
  end

  AddConversationOption(conversation, "I'm okay.")
  StartConversation(conversation, NPC, Player, "What is it you ask of me?")
end

function BuffMeBro(NPC, Player)
  local conversation = CreateConversation()
  AddConversationOption(conversation, "Noted.", "BuffPlayer")
  StartConversation(conversation, NPC, Player, "Very well, but know this: I've grown weary of war and will not tolerate attacks upon others in my vicinity. Do not challenge me. The outcome will not be in your favor.")
end

function GiveFoodDrink(NPC, Player)
  Say(NPC, "If you die, the effects will be lost. Worry not, you can always return to me for more.", Player)
  SummonItem(Player, 192273, 20)
  SummonItem(Player, 192275, 20)
end

function ChangeAlignment(NPC, Player)
  local conversation = CreateConversation()
  AddConversationOption(conversation, "I fight for Qeynos.", "ChangeQeynos")
  AddConversationOption(conversation, "I fight for Freeport.", "ChangeFreeport")
  AddConversationOption(conversation, "I fight for myself.", "ChangeExile")
  AddConversationOption(conversation, "On second thought, nevermind.")
  StartConversation(conversation, NPC, Player, "Hmm. Having trouble making up your mind? Who is it you fight for?")
end

function ChangeQeynos(NPC, Player)
  Say(NPC, "You now fight for the City of Qeynos.", Player)
  SetPlayerAlignment(Player, 1)
end

function ChangeFreeport(NPC, Player)
  Say(NPC, "You now fight for the City of Freeport.", Player)
  SetPlayerAlignment(Player, -1)
end

function ChangeExile(NPC, Player)
  Say(NPC, "Selfish - but you now fight for yourself.", Player)
  SetPlayerAlignment(Player, 2)
end

function BuffPlayer(NPC, Player)
  local AdventureClass = GetClass(Player)

  SetPlayerLevel(Player, 25)

  SummonItem(Player, 20930)
  SummonItem(Player, 20930)
  SummonItem(Player, 20930)

  SummonItem(Player, 20503, 200)
  SummonItem(Player, 20503, 200)
  SummonItem(Player, 20503, 200)
  SummonItem(Player, 20503, 200)

  BuffSkills(Player)

  if item_list[AdventureClass] ~= nil then
    for i, item in ipairs(item_list[AdventureClass]) do
      SummonItem(Player, item)
    end
  end
end

function BuffSkills(Player)
  local max_value = 125
  local skills = {"Slashing", "Crushing", "Piercing", "Ranged", "Ministration", "Disruption", "Subjugation", "Ordination", "Focus", "Parry", "Defense"}

  for i, skill_name in ipairs(skills) do
    local skill = GetSkill(Player, skill_name)

    if skill then
      SetSkillValue(skill, max_value)
    end
  end

  SendSkillUpdate(Player)
end
